import { e, r as r$1 } from './chunks/browser-polyfill-f636ce7e.js';
import { o } from './chunks/index-7b8f310d.js';
import { a as a$1 } from './chunks/create-58df95e7.js';
import { o as o$1 } from './chunks/storage-af31cd6f.js';
import './chunks/transframe-provider-e657167f.js';

var r=e=>`notification_job:${e}`,a=/^(http|https):\/\/*/;const i=["truffle.vip"],c=["youtube.com","twitch.tv","patreon.com"];console.log("PRIVILEGED_DOMAINS",i),console.log("MODIFIED_FETCH_DOMAINS",c);const d=e.exports.runtime.getManifest().manifest_version<3,u=new URL(e.exports.runtime.getURL("")).hostname;function l(e$1){const o=e$1.map((e=>e.toLowerCase())),n=e=>{var t;return {requestHeaders:null===(t=e.requestHeaders)||void 0===t?void 0:t.filter((e=>!o.includes(e.name.toLowerCase())))}},s=e=>{var t;return {responseHeaders:null===(t=e.responseHeaders)||void 0===t?void 0:t.filter((e=>!o.includes(e.name.toLowerCase())))}};return e.exports.webRequest.onBeforeSendHeaders.addListener(n,{urls:c.map((e=>`https://*.${e}/*`))},["blocking","requestHeaders"]),e.exports.webRequest.onHeadersReceived.addListener(s,{urls:c.map((e=>`https://*.${e}/*`))},["blocking","responseHeaders"]),()=>{e.exports.webRequest.onBeforeSendHeaders.removeListener(n),e.exports.webRequest.onHeadersReceived.removeListener(s);}}async function m(e){const t=[(o=e,{id:1,priority:1,action:{type:chrome.declarativeNetRequest.RuleActionType.MODIFY_HEADERS,responseHeaders:o.map((e=>({header:e,operation:chrome.declarativeNetRequest.HeaderOperation.REMOVE}))),requestHeaders:o.map((e=>({header:e,operation:chrome.declarativeNetRequest.HeaderOperation.REMOVE})))},condition:{requestDomains:c,initiatorDomains:[...i,u],resourceTypes:[chrome.declarativeNetRequest.ResourceType.MAIN_FRAME,chrome.declarativeNetRequest.ResourceType.SUB_FRAME,chrome.declarativeNetRequest.ResourceType.XMLHTTPREQUEST]}})];var o;return await chrome.declarativeNetRequest.updateSessionRules({addRules:t}),()=>{chrome.declarativeNetRequest.updateSessionRules({removeRuleIds:t.map((e=>e.id))});}}var p;a$1({api:{fetchWithRulesApplied:async(e,t,o,{headersToRemove:n}={})=>{const s=new URL(t),r=s.hostname.split(".").slice(-2).join(".");if(!c.includes(r))throw new Error(`Domain not whitelisted: ${s.hostname}`);let a;n&&(a=d?await l(n):await m(n));const i=fetch(t,o);try{const e=await i;return a&&a(),e.text()}catch(e){throw a&&a(),e}},removeHeaders:async(e,{headers:t,ttlMs:o})=>{let n;n=d?await l(t):await m(t),o&&setTimeout((()=>{n();}),o);},getCookies:async(e$1,o)=>{if(!["https://youtube.com","https://studio.youtube.com","https://www.youtube.com"].includes(o))throw console.error("Domain not whitelisted",o),new Error(`Domain not whitelisted: ${o}`);return await e.exports.cookies.getAll({url:o})}},namespace:"truffle-background-privileged-api-v1"}),function(e){e[e.Success=200]="Success",e[e.NotFound=404]="NotFound",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.Unknown=500]="Unknown";}(p||(p={}));let f=null;async function h(){const e=await chrome.declarativeNetRequest.getSessionRules();chrome.declarativeNetRequest.updateSessionRules({removeRuleIds:e.map((e=>e.id))});}function v(e){return {id:1,priority:1,action:{type:chrome.declarativeNetRequest.RuleActionType.MODIFY_HEADERS,responseHeaders:e.map((e=>({header:e,operation:chrome.declarativeNetRequest.HeaderOperation.REMOVE})))},condition:{urlFilter:"*",resourceTypes:[chrome.declarativeNetRequest.ResourceType.MAIN_FRAME,chrome.declarativeNetRequest.ResourceType.SUB_FRAME]}}}const g={extension:{popup:()=>r$1.action.openPopup(),"open-tab":async t=>{await r$1.tabs.create({url:t});},"fcm-token":async()=>{if(!chrome.gcm)return null;const{fcmToken:t}=await r$1.storage.local.get("fcmToken");return t},"remove-request-headers-temporarily":async({headers:t,ttlMs:o})=>{if(f&&clearTimeout(f),r$1.runtime.getManifest().manifest_version<3){const n=t.map((e=>e.toLowerCase())),s=e=>{var t;return {responseHeaders:null===(t=e.responseHeaders)||void 0===t?void 0:t.filter((e=>!n.includes(e.name.toLowerCase())))}};r$1.webRequest.onHeadersReceived.addListener(s,{urls:["<all_urls>"]},["blocking","responseHeaders"]),f=setTimeout((()=>{r$1.webRequest.onHeadersReceived.removeListener(s);}),o);}else await h(),await chrome.declarativeNetRequest.updateSessionRules({addRules:[v(t)]}),f=setTimeout((()=>{h();}),o);},"set-cookie-same-site-none":async({url:t,name:o})=>{const n=await r$1.cookies.get({url:t,name:o});r$1.cookies.set({domain:null==n?void 0:n.domain,expirationDate:null==n?void 0:n.expirationDate,httpOnly:null==n?void 0:n.httpOnly,name:null==n?void 0:n.name,path:null==n?void 0:n.path,sameSite:"no_restriction",secure:null==n?void 0:n.secure,storeId:null==n?void 0:n.storeId,url:t,value:null==n?void 0:n.value});}},twitch:{"get-gql-headers":async()=>o$1.twitch.get("headers"),"set-gql-headers":async e=>{await o$1.twitch.set("headers",e);}}},R=(e,t={},o)=>({body:t,meta:{isSuccess:!1,code:e,nonce:o}}),y=async(e,t)=>{var o;const{path:n,body:s}=e;if(!n)return;e.meta?e.meta.sender=t:e.meta={sender:t,isPort:!1},e.meta.isPort||(e.meta.isPort=!1);const r=e=>{},a=n.split("/").filter(Boolean),i=a[0];if(!(i in g)){return R(p.NotFound,void 0,e.nonce)}const c=g[i][a.slice(1).join("/")];if(!c){return R(p.NotFound,void 0,e.nonce)}try{const t=((e,t)=>({body:e,meta:{isSuccess:!0,code:p.Success,nonce:t}}))(await c(s,e.meta),e.nonce);return r(t),t}catch(t){const n=t;return R(null!==(o=n.code)&&void 0!==o?o:p.Unknown,{message:n.message},e.nonce)}};r$1.runtime.setUninstallURL(`https://truffle.vip/extension-survey?version=${r$1.runtime.getManifest().version}`),chrome.runtime.onStartup.addListener((()=>{console.log("onStartup()");})),r$1.runtime.onConnect.addListener((t=>{const o=t.sender;if(!o)return;const n=(e,o,n)=>{t.postMessage({type:"tab:updated",tabId:e,changeInfo:o,tab:n});};t.onDisconnect.addListener((()=>{r$1.tabs.onUpdated.removeListener(n);})),t.onMessage.addListener((async e=>{e.meta={isPort:!0};const n=await y(e,o);t.postMessage(n);})),r$1.tabs.onUpdated.addListener(n);})),r$1.runtime.onMessage.addListener(y),chrome.gcm&&(chrome.runtime.onInstalled.addListener((t=>{console.log("extention installed"),console.log("info",t),chrome.instanceID.getToken({authorizedEntity:"277610744288",scope:"GCM"}).then((t=>{console.log("FCM token",t),r$1.storage.local.set({fcmToken:t});}));})),chrome.gcm.onMessage.addListener((function(t){if(!chrome.gcm)return;let o="/assets/icon48.png",n=t?.data??{},s=n.notificationId??n.notificationJobId,a={type:"basic",title:n.notificationTitle??n["gcm.notification.title"]??" ",message:n.notificationBody??n["gcm.notification.body"]??" ",iconUrl:n.notificationIcon??n["gcm.notification.icon"]??o};r$1.storage.local.set({[r(s)]:n}),chrome.notifications.create(s,a,(()=>{let e=chrome.runtime.lastError;e&&(console.error("Error displaying notification:",e),a.iconUrl=o,chrome.notifications.create(s,a));}));})),chrome.notifications.onClicked.addListener((async function(t){let o=r(t),n=(await r$1.storage.local.get(o))?.[o];if(r$1.storage.local.remove(o),!n)return;let{action:s}=n;s&&a.test(s)&&r$1.tabs.create({url:s});}))),e.exports.runtime.onInstalled.addListener((async e$1=>{if("install"===e$1.reason){const e$1="https://app.truffle.vip/getting-started?reset=true";await e.exports.tabs.create({url:e$1});}})),e.exports.runtime.onMessageExternal.addListener((async function(e,t){if("pmnmpgjfacmjcnfigcmgfipemjpggmeg"!==t.id)return;const n=e.namespace,s=e.key;if(n&&s){if("get"===e.type)return o[n].get(s);if("set"===e.type){if(!e.data)return;return await o[n].set(s,e.data),!0}}}));

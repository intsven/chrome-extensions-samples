import { e } from '../../../chunks/background.injected-3706b340.js';
import { r as r$1 } from '../../../chunks/create-5399fd46.js';
import '../../../chunks/index-8b25a992.js';
import '../../../chunks/transframe-provider-e657167f.js';

var n=100,r=-1,o={"-32601":"Method not found"};o[n]="Invalid origin",o[r]="Error";var s=class{constructor({postMessage:e,timeout:t=3e3}={}){this.postMessage=e,this.timeout=t,this.pendingRequests={},this.callbackFunctions={},this.call=this.call.bind(this),this.resolve=this.resolve.bind(this),this.resolveRPCResponse=this.resolveRPCResponse.bind(this);}call(e,t,n={}){let{timeout:r=this.timeout}=n,o=function(){let e=null,t=null,n=new Promise(((n,r)=>(e=n,t=r,t)));return n.resolve=e,n.reject=t,n}(),s=[];for(let e of Array.from(t||[]))if("function"==typeof e){let t={_browserComms:!0,_browserCommsGunCallback:!0,callbackId:d()};this.callbackFunctions[t.callbackId]=e,s.push(t);}else s.push(e);let a=function({method:e,params:t}){if(null==t)throw new Error("Must provide params");for(let e of Array.from(t))if("function"==typeof e)throw new Error("Functions are not allowed. Use RPCCallback instead.");return {_browserComms:!0,id:d(),method:e,params:t}}({method:e,params:s});this.pendingRequests[a.id]={reject:o.reject,resolve:o.resolve,isAcknowledged:!1};try{this.postMessage(JSON.stringify(a),"*");}catch(e){return o.reject(e),o}return setTimeout((()=>{if(!this.pendingRequests[a.id].isAcknowledged)return o.reject(new Error("Message Timeout"))}),r),o}resolve(e){switch(!1){case t=e,!(!0===t?.acknowledge):return this.resolveRPCRequestAcknowledgement(e);case!c(e):return this.resolveRPCResponse(e);case!function(e){return e?.callbackId&&null!=e.params}(e):return this.resolveRPCCallbackResponse(e);default:throw new Error("Unknown response type")}var t;}resolveRPCResponse(e){let t=this.pendingRequests[e.id];if(null==t)throw new Error("Request not found");t.isAcknowledged=!0;let{result:n,error:r}=e;return r?t.reject(r.data||new Error(r.message)):null!=n?t.resolve(n):t.resolve(null),null}resolveRPCRequestAcknowledgement(e){let t=this.pendingRequests[e.id];if(null==t)throw new Error("Request not found");return t.isAcknowledged=!0,null}resolveRPCCallbackResponse(e){let t=this.callbackFunctions[e.callbackId];if(null==t)throw new Error("Callback not found");return t(...e.params||[]),null}};function a({params:e,callbackId:t}){return {_browserComms:!0,callbackId:t,params:e}}function i({requestId:e,result:t=null,rPCError:n=null}){return {_browserComms:!0,id:e,result:t,error:n}}function l({code:e,data:t=null}){return {_browserComms:!0,code:e,message:o[e],data:t}}function u(e){return e?._browserComms}function c(e){return e?.id&&(void 0!==e.result||void 0!==e.error)}function d(){let e=(new Date).getTime(),t=typeof performance<"u"&&performance.now&&1e3*performance.now()||0;return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){let r=16*Math.random();return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),("x"===n?r:3&r|8).toString(16)}))}var m=1e4,h=typeof document<"u"?window:typeof self<"u"?self:null,p=class{constructor(e={}){let{timeout:t,shouldConnectToServiceWorker:n,handshakeTimeout:r=m,isParentValidFn:o=(()=>!0)}=e;this.handshakeTimeout=r,this.isParentValidFn=o,this.isListening=!1,this.isNotTopWindow=typeof document<"u"&&window.self!==window.top,this.hasParent=globalThis?.window?.ReactNativeWebView||this.isNotTopWindow,this.isNotTopWindow?this.parent=globalThis?.window?.parent:this.parent=globalThis?.window?.ReactNativeWebView||globalThis?.window?.parent,this.client=new s({timeout:t,postMessage:(e,t)=>{globalThis?.window?.ReactNativeWebView&&!this.isNotTopWindow?this.parent?.postMessage(e):this.parent?.postMessage(e,t);}}),this.waitForSw=n&&function(){return new Promise(((e,t)=>{let n=setTimeout(e,5e3);return navigator?.serviceWorker?.ready.catch((function(){return console.log("caught sw error"),null})).then((t=>{let r=t?.active;return r&&(this.sw=new s({timeout:this.timeout,postMessage:(e,t)=>{let n=new MessageChannel;if(n)return n.port1.onmessage=e=>this.onMessage(e,{isServiceWorker:!0}),r.postMessage(e,[n.port2])}})),clearTimeout(n),e()}))}))}(),this.registeredMethods={ping:()=>Object.keys(this.registeredMethods)},this.parentsRegisteredMethods=[],this.parentHasMethod=this.parentHasMethod.bind(this),this.setParent=this.setParent.bind(this),this.listen=this.listen.bind(this),this.close=this.close.bind(this),this.call=this.call.bind(this),this.onRequest=this.onRequest.bind(this),this.onMessage=this.onMessage.bind(this),this.on=this.on.bind(this);}setParent(e){this.parent=e,this.hasParent=!0;}listen(){this.isListening=!0,h.addEventListener?.("message",this.onMessage,!0),this.waitForParentPing=this.hasParent&&this.client.call("ping",null,{timeout:this.handshakeTimeout}).then((e=>{this.parentsRegisteredMethods=this.parentsRegisteredMethods.concat(e);})).catch((()=>null)),this.waitForSwPing=this.waitForSw&&this.waitForSw.then((()=>this.sw?.call("ping",null,{timeout:this.handshakeTimeout}))).then((e=>{this.parentsRegisteredMethods=this.parentsRegisteredMethods.concat(e);})).catch((()=>null));}close(){return this.isListening=!0,h?.removeEventListener("message",this.onMessage)}parentHasMethod(e){return -1!==this.parentsRegisteredMethods.indexOf(e)}async call(e,...t){if(!this.isListening)return new Promise(((e,t)=>t(new Error("Must call listen() before call()"))));let n=(e,t)=>{let n=this.registeredMethods[e];if(!n)throw new Error("Method not found: "+e);return n(...t)};if(this.waitForSw&&await this.waitForSw,!this.hasParent&&!this.sw)return n(e,t);{let r=null;if(this.waitForParentPing&&await this.waitForParentPing,this.waitForSwPing&&await this.waitForSwPing,this.parentHasMethod(e)){let o;try{if(!this.hasParent)throw new Error("No parent");o=await this.client.call(e,t);}catch(s){try{if(r=s,!this.sw)return n(e,t);try{o=await this.sw.call(e,t);}catch{return n(e,t)}}catch(e){throw "Method not found"===e.message&&r?r:e}}if("ping"===e){let r=n(e,t);o=(o||[]).concat(r);}return o}return n(e,t)}}async onRequest(e,t,n){let o=[];for(let n of Array.from(t.params||[]))s=n,s?._browserCommsGunCallback?(t=>{o.push(((...n)=>e(a({params:n,callbackId:t.callbackId}))));})(n):o.push(n);var s;e(function({requestId:e}){return {_browserComms:!0,id:e,acknowledge:!0}}({requestId:t.id}));try{let r=await this.call(t.method,...Array.from(o),{e:n});return e(i({requestId:t.id,result:r}))}catch(n){return e(i({requestId:t.id,rPCError:l({code:r,data:n})}))}}onMessage(e,{isServiceWorker:t,reply:r}={}){try{let s="string"==typeof e.data?JSON.parse(e.data):e.data;if(!u(s))return;if(r=r||function(t){return typeof document<"u"&&null!==window?e.source?.postMessage(JSON.stringify(t),"*"):e.ports[0].postMessage(JSON.stringify(t))},o=s,null!=o?.id&&null!=o.method)return this.onRequest(r,s,e);if(u(s)){let r;if(this.isParentValidFn(e.origin))return r=t?this.sw:this.client,r.resolve(s);if(c(s))return r=t?this.sw:this.client,r.resolve(i({requestId:s.id,rPCError:l({code:n})}));throw new Error("Invalid origin")}throw new Error("Unknown RPCEntity type")}catch{}var o;}on(e,t){this.registeredMethods[e]=t;}};var f="width: 0; height: 0;",g="truffle";var w,y=((w=y||{}).ANDROID="native-android",w.IOS="native-ios",w.CHROME="extension-chrome",w.FIREFOX="extension-firefox",w.SAFARI="extension-safari",w);function b(e){return void 0!==e.image}var v=["src","width","height","id","class"];var E=e=>`data-truffle-assoc-mutation-observer-id-${e}`,I=e=>`data-truffle-assoc-mutated-element-id-${e}`,S="data-truffle-id",M=e=>`[${S}=${e}]`,C="data-truffle-has-mutated";function k(e,{subjectElement:t,mutationObserverId:n,mutatedElementId:r,cleanupMutationsByMutatedElementId:o}={}){let s=document.documentElement,a=e=>{n&&e.setAttribute(E(n),"1"),r&&e.setAttribute(I(r),"1");};return e.forEach((e=>{switch(e.action){case"appendSubject":t&&s?.appendChild(t);break;case"prependSubject":t&&s?.prepend(t);break;case"resetStyles":s&&s.setAttribute("style",f);break;case"cleanupMutationsByMutatedElementId":e.value&&o&&o(e.value);break;case"useDocument":s=document.documentElement;break;case"getIframeDocument":{let e=s;s=e?.contentDocument?.documentElement??e?.contentWindow?.document?.documentElement;break}case"insertSubjectBefore":t&&s?.parentNode?.insertBefore(t,s);break;case"insertSubjectAfter":t&&s?.parentNode?.insertBefore(t,s?.nextSibling);break;case"querySelector":e.value&&(s=s?.querySelector(e.value));break;case"createImageSubject":{let n=function(e){return void 0!==e.src}(e.value)?e.value:JSON.parse(e.value),r=document.createElement("img");Object.entries(n).forEach((([e,t])=>{(function(e){return v.includes(e)})(e)&&r.setAttribute(e,t);})),a(t=r);break}case"replaceStringsWithImages":(b(e.value)?e.value:JSON.parse(e.value)).forEach((({string:e,image:t})=>{let n=document.createElement("img");n.src=x(t.src),t.height&&(n.height=t.height),t.width&&(n.width=t.width),n.title=e,s&&P(s,e,n).forEach(a);}));break;case"createReplacedStringsWithImagesSubject":{let n=b(e.value)?e.value:JSON.parse(e.value),r=s;if(n.forEach((({string:e,image:t})=>{let n=document.createElement("img");n.src=x(t.src),t.height&&(n.height=t.height),t.width&&(n.width=t.width),n.title=e,r&&(r=function(e,t,n){let r=document.createElement("template");for(let o of e.childNodes)if(o.nodeType===Node.TEXT_NODE){let e=document.createElement("template"),s=o.textContent?.replaceAll(t,n.outerHTML);s&&(e.innerHTML=s,r.append(...e.content.childNodes));}else r.appendChild(o);return r}(r,e,n));})),r!==s){let e=document.createElement("span");e.append(...r?.childNodes??[]),a(e),t=e;}else t=null;break}case"replaceWithSubject":t&&s?.replaceWith(t);break;case"requestPictureInPicture":s?.requestPictureInPicture?.();break;case"setStyle":{let t="string"==typeof e.value?JSON.parse(e.value):e.value;Object.entries(t).forEach((([e,t])=>{s&&(s.style[e]=t);}));break}case"setStyleSheet":{let t=s?.ownerDocument??document,n="string"==typeof e.value?JSON.parse(e.value):e.value,r=n?.id?t.getElementById(n?.id):t.createElement("style");r||(r=t.createElement("style"),t.head.appendChild(r)),r.innerText=e.value?.css??n.css,n?.id&&(r.id=n?.id),n?.class&&(r.className=n?.class),a(r);break}case"setId":s&&e.value&&(s.id=e.value);break;case"addClassNames":if(!s)break;Array.isArray(e.value)?s.classList.add(...e.value):"string"==typeof e.value&&s.classList.add(e.value);break;case"removeClassNames":if(!s)break;Array.isArray(e.value)?e.value.forEach((e=>s?.classList.remove(e))):"string"==typeof e.value&&s.classList.remove(e.value);break;case"webComponentMethod":{if(!s)break;let t="string"==typeof e.value?JSON.parse(e.value):e.value;s?.[t.method]?.(...t.args);break}case"useSubject":s=t;}})),r&&document.querySelector(M(r))?.setAttribute(C,"1"),s}function x(e){let t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText}function P(e,t,n){let r=[];for(let o of e.childNodes)switch(o.nodeType){case Node.ELEMENT_NODE:r.push(...P(o,t,n));break;case Node.TEXT_NODE:{let e=O(o);e&&(e.innerHTML=e.innerHTML.replace(t,n.outerHTML),r.push(e));break}case Node.DOCUMENT_NODE:r.push(...P(o,t,n));}return r}function O(e){let t=document.createElement("span");if(e?.textContent&&e?.parentNode){let n=document.createTextNode(e.textContent);return t.appendChild(n),e.parentNode.replaceChild(t,e),t}}var T,j=class{},L=new class extends j{getPageIdentifiers(){return [{sourceType:"url",sourceId:window.location.href}]}getPageInfo(){return {title:document.title,url:window.location.href,contentPageId:"",contentPageOwnerRef:"",site:"genericSite",contentPageType:"url",data:{}}}},R=/[a-zA-Z0-9_]+/,N=new class extends j{getPageIdentifiers(){let e=[{sourceType:"url",sourceId:window.location.href}];if("player.twitch.tv"===window.location.hostname.replace(/^www\./,"")){let t=new URLSearchParams(window.location.search),n=Object.fromEntries(t.entries());e=e.concat({sourceType:"twitchEmbed",sourceId:n.channel});}else {let t=window.location.pathname.match(R)?.[0];t&&(e=e.concat({sourceType:"twitch",sourceId:t}));}return e}getPageInfo(){let e,t,n;if("player.twitch.tv"===window.location.hostname.replace(/^www\./,"")){e="twitchEmbed";let r=new URLSearchParams(window.location.search),o=Object.fromEntries(r.entries());n=o.channel,t=o.channel;}else {e="twitch";let r=window.location.pathname.match(R)?.[0];t=r||"",n=r||"";}return {title:document.title,url:window.location.href,contentPageType:e,contentPageId:n,contentPageOwnerRef:t,site:"twitch",data:{}}}},A=new class extends j{getPageIdentifiers(e){let t=document.querySelector("ytd-app")?.data?.playerResponse?.videoDetails??document.querySelector("ytd-page-manager")?.data?.playerResponse?.videoDetails??document.querySelector("ytm-app")?.data?.playerResponse?.videoDetails,n=[{sourceType:"url",sourceId:window.location.href}];if(t?.channelId){let e=t.channelId,r=t.videoId,o=t.isLiveContent?"youtubeLiveContent":"youtubeVideo";n.push({sourceType:"youtube",sourceId:e}),n.push({sourceType:o,sourceId:e,data:{videoId:r}}),t.isLiveContent&&n.push({sourceType:t.isLive||t.isUpcoming?"youtubeLive":"youtubeVod",sourceId:e,data:{videoId:r}});}return n}getPageInfo(){let e,t=document.querySelector("ytd-app")?.data?.playerResponse?.videoDetails??document.querySelector("ytd-page-manager")?.data?.playerResponse?.videoDetails??document.querySelector("ytm-app")?.data?.playerResponse?.videoDetails;return e=t?.isLiveContent?t.isLive?"youtubeLiveNow":t.isUpcoming?"youtubeLiveUpcoming":"youtubeVod":"youtubeVideo",{title:t?.title||document.title,url:window.location.href,contentPageType:e,contentPageId:t?.videoId||"",contentPageOwnerRef:t?.channelId||"",site:"youtube",data:{}}}},q={genericSite:L,twitch:N,youtube:A},D=class{_lastUrl=window.location.href;_onPageInfoChangedListeners=new Set;getPageInfo(){let e=this.getSiteByUrl(),t=q[e].getPageInfo();return this._lastUrl!==t.url&&(this._onPageInfoChangedListeners.forEach((e=>{e(t);})),this._lastUrl=t.url),t}getSiteByUrl(e=window.location.href){switch(new URL(e).hostname.replace(/^www\./,"")){case"twitch.tv":case"player.twitch.tv":return "twitch";case"youtube.com":case"m.youtube.com":return "youtube";default:return "genericSite"}}addOnPageInfoChangedListener(e){this._onPageInfoChangedListeners.add(e);}removeOnPageInfoChangedListener(e){this._onPageInfoChangedListeners.delete(e);}};function B(){return T||(T=new D),T}var U,F=100,W=3e3;function _({onPageInfoChange:e,onDomChange:t,platform:n}){let r=()=>{$(n,e),t(),B().getPageInfo();},o=()=>{let e=document.querySelector("body");if(!e)return void console.error("body not found");let t=function(e,t=200){let n;return (...r)=>{clearTimeout(n),n=setTimeout((()=>e(...r)),t);}}(r,F);new MutationObserver(t).observe(e,{childList:!0,subtree:!0});};["interactive","complete"].includes(document.readyState)?o():window.addEventListener("DOMContentLoaded",o),setInterval(r,W),$(n,e);}function $(e,t){let n=V(e),r=JSON.stringify(n);r!==U&&(U=r,t(n));}function V(e){let t=B().getSiteByUrl();return q[t].getPageIdentifiers(e)}var H,J="query GetEmbedConnection(\n    $input: EmbedConnectionInput\n  ) {\n  embedConnection(input: $input) {\n    nodes {\n      id\n      name\n      iconUrl\n      slug\n      orgId\n      url\n      packageId\n      packageInstallId\n      isLoginRequired\n      windowProps\n      defaultLayoutConfigSteps { action, value }\n      iframeUrl\n      sourceType\n      sourceId\n    }\n  }\n}";async function G({sources:e,statuses:t}){let n={input:{sources:e,extensionVersion:"4.4.16",statuses:t}};try{return (await async function(e,t,n,{throwIfErrors:r}={}){let o=await(await fetch(e,{method:"POST",headers:{Authorization:"Bearer pk_U1x92ZrrdQoflf2JycecdmnilAGRAkmUNBpxPnVPDdeUKcsH","Content-Type":"application/json"},body:JSON.stringify({query:t,variables:n})})).json();if(r&&o?.errors)throw new Error(`truffle graphql error ${o.errors}`);return o.data}("https://mycelium.truffle.vip/graphql",J,n)).embedConnection}catch(e){console.error(e);}}var Q="truffle-embed",z="truffle-embed",X=[];async function Z({platform:e,pageIdentifiers:t,isExperimentalEnabled:n}){let r=n?["published","experimental"]:["published"];["native-android","native-ios"].includes(e)&&(r[0]="native");let o=t.map((({sourceType:e,sourceId:t})=>({sourceType:e,sourceId:t})));((await G({sources:o,statuses:r}))?.nodes||[]).forEach((e=>{!function(e){if(X.find((t=>e.id===t.embed.id)))return;let t=document.createElement("iframe");t.src=e.url||e.iframeUrl,t.id=Y(e),t.className=Q,t.allow="fullscreen; microphone; camera; autoplay; encrypted-media;",t.setAttribute("style",f),t.dataset.truffleEmbedId=e.id,t.dataset.orgId=e.orgId;let n={embed:e,element:t};X.push(n),K(n);}(e);}));}function K(e){let t=function(e){let t,n=localStorage.getItem(te(e.id));try{t=n&&JSON.parse(n);}catch{console.error("error parsing json",n);}return t||e.defaultLayoutConfigSteps}(e.embed);k(t,{subjectElement:e.element});}function Y(e){return `${z}-${e.id}`}function ee(e){if(function(e){return !(!e||e.ownerDocument===document)}(e)){let t=e?.ownerDocument;return !(!t?.defaultView||!t?.body.contains(e))}return !!e?.parentNode}function te(e){return `${g}:embedLayoutConfigSteps:${e}`}function ne(e){return X.find((t=>t.element.contentWindow===e))}window.addEventListener("blur",(()=>{X.find((e=>{document.activeElement==e.element&&async function({metricSlug:e,orgId:t,dimensionValues:n}){let r=await async function(){return H?.()}();r&&fetch("https://mycelium.truffle.vip/graphql",{method:"POST",body:JSON.stringify({query:"mutation DatapointIncrementUnique ($input: DatapointIncrementUniqueInput!) {datapointIncrementUnique(input: $input) { isUpdated }}",variables:{input:{metricSlug:e,dimensionValues:n}}}),headers:{"Content-Type":"application/json","x-org-id":t,"x-access-token":r}});}({metricSlug:"embed-engaged-users",orgId:e.embed.orgId,dimensionValues:{embed:e.embed.slug||e.embed.slug}});}));}));function re(e,t){let{observer:n,listenElement:r,targetQuerySelector:o,emit:s,normalizeElement:a,observerConfig:i,prepareLayoutConfigSteps:l}=e;if(!r)return;let u=r.querySelectorAll(o),c=Array.from(u||[]).map((e=>a(e)));s(c),l&&u.forEach((e=>{k(l,{subjectElement:e,cleanupMutationsByMutatedElementId:t});})),n.observe(r,i);}var oe=new class{constructor(){this.jumper=new p,this.observerObjects=[],this.messageCallbacks=[],this.mutatedElementIdMap=new Map,this.mutationObserverIdMap=new Map;}jumper;observerObjects;messageCallbacks;mutatedElementIdMap;mutationObserverIdMap;call=(e,t)=>this.jumper.call(e,t);listen=()=>{this.jumper.listen(),this.jumper.on("context.getInfo",this.contextGetInfo),this.jumper.on("context.getEmbeds",this.contextGetEmbeds),this.jumper.on("layout.applyLayoutConfigSteps",this.layoutApplyLayoutConfigSteps),this.jumper.on("layout.setDefaultLayoutConfigSteps",this.layoutSetDefaultLayoutConfigSteps),this.jumper.on("layout.addEventListener",this.layoutAddEventListener),this.jumper.on("layout.dispatchEvent",this.layoutDispatchEvent),this.jumper.on("layout.click",this.layoutClick),this.jumper.on("layout.listenForElements",this.layoutListenForElements),this.jumper.on("layout.getElementBoundingClientRect",this.getElementBoundingClientRect),this.jumper.on("comms.postMessage",this.commsPostMessage),this.jumper.on("comms.onMessage",this.commsOnMessage),this.jumper.on("storage.get",this.storageGet),this.jumper.on("storage.set",this.storageSet),this.jumper.on("platform.log",this.platformLog);};platformLog=e=>{console.log(e),window?.ReactNativeWebView?.postMessage(`platform.log: ${JSON.stringify(e)}`);};cleanupEmbedInstance=e=>{this.messageCallbacks=this.messageCallbacks.filter((({eventSource:t})=>!(e.element.contentWindow===t))),this.observerObjects=this.observerObjects.filter((({eventSource:t,mutationObserverId:n})=>{let r=e.element.contentWindow===t;return r&&this.cleanupMutationsByMutationObserverId(n),!r}));};cleanupMutationsByMutatedElementId=e=>{this.mutatedElementIdMap.get(e)?.forEach((e=>e.remove()));};cleanupMutationsByMutationObserverId=e=>{this.mutationObserverIdMap.get(e)?.forEach((e=>e.remove()));};contextGetInfo=async()=>{let e=function(){if("ReactNativeWebView"in window)return navigator.userAgent.match(/iP(hone|od|ad)/g)?"native-ios":"native-android";if(navigator.userAgent.indexOf("Chrome"))return "extension-chrome";if(navigator.userAgent.includes("Firefox"))return "extension-firefox";if(navigator.userAgent.indexOf("Safari"))return "extension-safari"}();return {version:"4.4.16",platform:e,pageInfo:V(e)}};contextGetEmbeds=()=>X.map((e=>({embed:e.embed,element:null})));layoutApplyLayoutConfigSteps=async({layoutConfigSteps:e,mutatedElementId:t,skipThrow:n},{e:r}={})=>{let o,s;if(!r||n&&!r.source?o=document.documentElement:(s=r?.source&&await this.getEmbedInstanceByEventSource(r.source),o=s?.element),!o)throw new Error("DOM element not found");let a=this.observerObjects.find((({eventSource:e})=>s?.element.contentWindow===e));var i;k(e,{subjectElement:o,mutationObserverId:a?.mutationObserverId,mutatedElementId:t,cleanupMutationsByMutatedElementId:this.cleanupMutationsByMutatedElementId}),a?.shouldCleanupMutatedElements&&(a.mutationObserverId&&this.mutationObserverIdMap.set(a.mutationObserverId,Array.from(document.querySelectorAll((i=a.mutationObserverId,`[${E(i)}]`)))),t&&this.mutatedElementIdMap.set(t,Array.from(document.querySelectorAll((e=>`[${I(e)}]`)(t)))));};layoutSetDefaultLayoutConfigSteps=({layoutConfigSteps:e},{e:t}={})=>{let n;if(t?.source&&(n=ne(t.source)),!n)throw new Error("extension mapping not found");localStorage.setItem(te(n.embed.id),JSON.stringify(e)),k(e,{subjectElement:n.element,cleanupMutationsByMutatedElementId:this.cleanupMutationsByMutatedElementId});};layoutDispatchEvent=({targetElementLayoutConfigSteps:e,eventName:t})=>{let n=k(e);if(!n)throw new Error("DOM element not found");n?.dispatchEvent(new Event(t));};layoutClick=({targetElementLayoutConfigSteps:e})=>{let t=k(e);if(!t)throw new Error("DOM element not found");t?.click();};layoutAddEventListener=({targetElementLayoutConfigSteps:e,eventName:t},n)=>{let r=k(e);if(!r)throw new Error("DOM element not found");r?.addEventListener(t,n);};layoutListenForElements=({listenElementLayoutConfigSteps:e,targetQuerySelector:t,pickStyles:n=[],observerConfig:r={},prepareLayoutConfigSteps:o,shouldCleanupMutatedElements:s=!1},a,{e:i}={})=>{if("function"!=typeof a)return void console.warn("Emit function not set");let l=Date.now().toString(36)+Math.random().toString(36).substr(2),u=e=>{let t=e.getAttribute(S)||"",r=!!e.getAttribute(C),o=t||Date.now().toString(36)+Math.random().toString(36).substr(2);t||e.setAttribute(S,o);let s=n?.length?function(e,t){return Object.fromEntries(t.filter((t=>t in e)).map((t=>[t,e[t]])))}({...window.getComputedStyle(e)},n):{},a=Object.fromEntries(Array.from(e.attributes).map((e=>[e.nodeName,e.nodeValue])));return {id:o,existingMutatedElementId:t,hasMutated:r,mutationObserverId:l,attributes:a,data:e.data,innerText:e.innerText,innerHtml:e.innerHTML,styles:s}},c=this.observerObjects.find((({eventSource:e})=>e===i?.source));c&&(c.observer.disconnect(),l=c.mutationObserverId);let d=new MutationObserver((e=>{let n=e.filter((e=>!("attributes"!==e.type||!e.target?.matches(t))||(e?.addedNodes&&Array.from(e.addedNodes).filter((e=>e?.matches&&e.matches(t))))?.length>0)).map((e=>"attributes"===e.type?e.target:Array.from(e.addedNodes))).flat(),r=n.map(u);r?.length&&(a(r),o&&n.forEach((e=>{k(o,{subjectElement:e,cleanupMutationsByMutatedElementId:this.cleanupMutationsByMutatedElementId});})));})),m=k(e,{cleanupMutationsByMutatedElementId:this.cleanupMutationsByMutatedElementId}),h={eventSource:i?.source,observer:d,listenElement:m,listenElementLayoutConfigSteps:e,observerConfig:r,targetQuerySelector:t,emit:a,normalizeElement:u,prepareLayoutConfigSteps:o,mutationObserverId:l,shouldCleanupMutatedElements:s};if(this.observerObjects.push(h),!m)throw console.warn("missing dom element",e,window.location.href),new Error("DOM element not found");re(h,this.cleanupMutationsByMutatedElementId);};commsPostMessage=(...e)=>{this.messageCallbacks.forEach((({callback:t})=>t(...e)));};commsOnMessage=(e,{e:t}={})=>{this.messageCallbacks.push({callback:e,eventSource:t?.source});};storageGet=({key:e})=>localStorage.getItem(`${g}:${e}`);storageSet=({key:e,value:t})=>{localStorage.setItem(`${g}:${e}`,t);};attachDetachedMutationObservers=()=>{this.observerObjects.forEach((e=>{let t=e.listenElement&&ee(e.listenElement),n=t?e.listenElement:k(e.listenElementLayoutConfigSteps,{cleanupMutationsByMutatedElementId:this.cleanupMutationsByMutatedElementId});n&&!t&&(e.listenElement=n,re(e,this.cleanupMutationsByMutatedElementId));}));};getElementBoundingClientRect({querySelector:e}){return e?document.querySelector(e)?.getBoundingClientRect():void 0}getEmbedInstanceByEventSource=async e=>{let t=e&&ne(e);if(t)return t;let n=await this.call("context.getEmbeds",{}),r=[...Array.from(document.querySelectorAll("iframe"))].find((t=>t.contentWindow===e));return t=n.find((e=>Y(e.embed)===r?.id)),r&&t&&(t.element=r),t}};const se=r$1({providerWindow:window,namespace:"truffle-legacy-privileged-api-v1",connectImmediately:!1});se.connect().catch((e=>{}));const ae=se.api,ie=new e,le=y.CHROME;async function ue(){return await ae.getGlobalUserAccessToken()}async function ce(){const e=await ie.fetch("/extension/fcm-token");return null==e?void 0:e.body}!function({onPageInfoChange:e,onDomChange:t,platform:n,getAccessToken:r,isExperimentalEnabledPromise:o}){((function(e){H=e;}))(r),oe.listen(),_({onPageInfoChange:async t=>{!function(e,t){console.log("cleaning up embeds",X);let n=[],r=[];X.forEach((t=>{let{embed:o}=t;e.find((({sourceType:e,sourceId:t})=>o.sourceType===e&&o.sourceId===t))?r.push(t):n.push(t);})),n.forEach((e=>{let{element:n}=e;n&&(t.cleanupEmbedInstance(e),n?.remove());})),X=r;}(t,oe);let r=await o;Z({platform:n,pageIdentifiers:t,isExperimentalEnabled:r}),e?.(t);},onDomChange:()=>{X.forEach((e=>{ee(e.element)||K(e);})),oe.attachDetachedMutationObservers(),t?.();},platform:n});}({isExperimentalEnabledPromise:Promise.resolve(!1),platform:le,getAccessToken:ue}),oe.jumper.on("user.setAccessToken",(async function({accessToken:e}){return await ae.setGlobalUserAccessToken(e)})),oe.jumper.on("user.getAccessToken",ue),oe.jumper.on("extension.getFCMToken",ce),oe.jumper.on("extension.getFcmToken",ce),oe.jumper.on("extension.removeRequestHeaders",(async function({headers:e=[],ttlMs:t=5e3}){t=Math.min(t,6e5);return (await ie.fetch("/extension/remove-request-headers-temporarily",{headers:e,ttlMs:t})).body})),oe.jumper.on("extension.setCookieSameSiteNone",(async function({url:e,name:t}){return (await ie.fetch("/extension/set-cookie-same-site-none",{url:e,name:t})).body})),oe.jumper.on("twitch.getSubscribeButtonUser",(async function({channelName:e}){if(!window.location.host.includes("twitch.tv"))throw new Error("must be called from twitch.tv");const t=(await ie.fetch("/twitch/get-gql-headers")).body;try{return (await fetch("https://gql.twitch.tv/gql",{headers:t,referrer:"https://player.twitch.tv/",referrerPolicy:"strict-origin-when-cross-origin",body:`[{"operationName":"ChannelPage_SubscribeButton_User","variables":{"login":"${e}"},"extensions":{"persistedQuery":{"version":1,"sha256Hash":"711531c82eba59a653a495c90814d10c0e06c722dd915f7a60565e459960c4bb"}}}]`,method:"POST"})).json()}catch(e){throw console.log("fetch err",e),e}}));
